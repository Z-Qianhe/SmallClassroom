<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频详情</title>
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_2384888_ojge9md3tr.css
    ">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/online.css">
    <link rel="stylesheet" href="../css/index.css">
    <script src="../js/vue-v2.6.10.js"></script>
    <script src="../js/axios-0.18.0.js"></script>
</head>

<body>
    <div id="app">
        <!-- 导航菜单 -->
        <nav>
            <div class="main">
                <img src="../img/public/logo.png" alt="" class="logo">
                <ul>
                    <li><a href="../index.html">首页</a></li>
                    <li class="check"><a href="online.html">全部课程</a></li>
                    <li><a href="javascript:;">在线练习</a></li>
                    <li><a href="javascript:;">精品课程</a></li>
                </ul>
                <div class="search">
                    <div class="left">课程<i class="iconfont icon-down"></i>
                    </div>
                    <input type="text" placeholder="搜索感兴趣的内容" v-model="courseName">
                    <img src="../img/public/search.png" alt="" @click="getCourse(1)">
                </div>

                <div class="login" v-if="login_flag">
                    <a href="../pages/loginAndRegister/login.html">登陆</a>
                    /
                    <a href="../pages/loginAndRegister/register.html">注册</a>
                </div>
                <div class="user" v-else>
                    <img src="../img/login/user.png" alt="">
                    <div class="userlist">
                        <ul>
                            <li>{{user.name}}</li>
                            <a href="../pages/course.html">
                                <li>课程中心</li>
                            </a>
                            <li>订单中心</li>
                            <li>资金管理</li>
                            <li>个人中心</li>
                            <li class="out" @click="logout">退出登陆</li>
                        </ul>
                    </div>
                </div>

            </div>
        </nav>

        <!-- 主体内容 -->
        <main>
            <div class="row">
                <div class="left">按版本选择</div>
                <div class="right">
                    <ul>
                        <li><a @click="getCourseByType(0)" :class="{active:courseType == 0}">全部</a></li>
                        <li><a @click="getCourseByType(1)" :class="{active:courseType == 1}">java</a></li>
                        <li><a @click="getCourseByType(2)" :class="{active:courseType == 2}">数据库</a></li>
                        <li><a @click="getCourseByType(3)" :class="{active:courseType == 3}">前端</a></li>
                    </ul>
                </div>
            </div>
            <div class="lesson">
                <ul style="text-align:center;">
                    <li v-for="course in courseList">
                        <div class="top">
                            <a :href="'videoDetail.html?cid='+course.cid">
                                <img :src="'/uploadFile/'+course.courseImage" alt="" class="m"></a>
                            <p>{{course.count}}人在学习</p>
                        </div>
                        <div class="bottom">
                            <div class="left">
                                <span>{{course.courseName}}</span>
                                <span class="time">RMB:{{course.coursePrice}}</span>
                            </div>
                            <div class="right">免费学习</div>
                        </div>
                    </li>

                </ul>
            </div>

            <div class="pageNum">
                <button @click="getCourse(1)">首页</button>
                <button @click="getCourse(prevPage)">上一页</button>
                <ul>
                    <!--css中设置过 如果class是active  就会显示蓝色-->
                    <li v-for="page in countPage" :class="{active:page == currentPage}">
                        {{page}}
                    </li>
                </ul>
                <button @click="getCourse(nextPage)">下一页</button>
                <button @click="getCourse(countPage)">尾页</button>
            </div>
        </main>
        <footer>
            <div class="cont">
                <div class="main">
                    <p>
                        首页 | 关于我们 | 加入我们 | 合作专区 | 联系我们 | AI开放平台 | 意见反馈 | 漏洞提交 | 隐私政策 | 版权声明 | 反盗链声明 | 网上有害信息举报 | 备案公示 |
                        营业执照
                        | 教师资格证公示
                    </p>
                    <p>
                        京ICP备10218183号-1 京ICP证161188号 七易时代科技有限公司 | 地址：北京市昌平区慧聪采购园 | 电话：010-66666666 | 京公网安备
                        01010102002533号
                    </p>
                    <p>
                        京网文〔2018〕4086-308号 | 网络文化经营许可证：沪网文[2018]4086-308号 | 增值电信业务经营许可证：京B2-20150021 |
                    </p>
                    <p>在线教育许可证：小优课堂经营许可证20188008号 | 互联网教育服务资格证书：(京)-经营性-2018-0011 |</p>
                </div>
            </div>
        </footer>
    </div>
</body>
<script>
    new Vue({
        el: "#app",
        data: {
            login_flag : true,
            user : '',
            currentPage : 1,    //当前页
            pageSize : 6,       //每页展示的数据条数
            courseList : [],    //分页的课程数据
            countPage : '',     //总页数
            prevPage : '',      //上一页
            nextPage : '',      //下一页
            courseName : '',    //搜索的数据
            courseType : 0      //按照类型展示  搜索
        },
        methods: {
            initParams() {
                //从vue自己的session域对象中获取数据
                var user =  sessionStorage.getItem("user");
                //判断当前页面中用户是否登陆了
                if(user == null || user == ""){
                    //证明当前的用户为登陆 展示登陆和注册的div
                    this.login_flag = true;
                }else {
                    //证明当前用户已经登陆 展示用户状态的div
                    this.login_flag = false;
                    //展示用户数据 本身登陆成功后将数据转化为json字符串，我们如果要在页面中展示数据需要将字符串转化为json对象
                    this.user = JSON.parse(user);
                }
            },
            logout(){
                //用户退出的方法 异步调用后台退出的方法
                axios.post("/user/loginOut").then(res => {
                    //删除vue会话数据
                    sessionStorage.removeItem("user");
                //跳转到登陆页面
                location.href = "/";
                })
            },
            getCourse(page){
                //page就是要跳转的页面  将要跳转的页面设置为当前页
                this.currentPage = page;
                //封装一个pageUtli数据 做分页数据的查询
                var param = {
                    currentPage : this.currentPage,         //当前页
                    pageSize : this.pageSize,               //每页的条数
                    queryString : this.courseName,          //查询的条件
                    courseType : this.courseType            //查询的类型
                };
                //异步查询分页数据的方法
                axios.post("/course/getCourseByPage",param).then(res=>{
                    //判断是否查询成功
                    if(res.data.flag){
                        //将分页数据设置到页面
                        this.courseList = res.data.data.rows;
                        //设置总页数  这个不是后台传递的  需要我们自己计算
                        this.countPage = res.data.data.totalCount % this.pageSize == 0 ?
                            parseInt(res.data.data.totalCount/this.pageSize):
                            parseInt(res.data.data.totalCount/this.pageSize)+1;
                        //设置上一页
                        this.prevPage = this.currentPage == 1?1:this.currentPage-1;
                        //设置下一页
                        this.nextPage = this.currentPage == this.countPage ? this.currentPage : this.currentPage +1;
                    }
                })
            },
            getCourseByType(type){
                //将当前的查询类型设置为传递类型
                this.courseType = type;
                //调用分页的方法
                this.getCourse(1);
            }
        },
        created() {
            //初始化判断用户登陆的方法
            this.initParams();
            //调用分页的方法
            this.getCourse(1);
        },

    })
</script>

</html>